<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiquidBackdrop Playground</title>
    <style>
        body {
            margin: 0; background: #000; color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            height: 100vh; overflow: hidden;
            display: flex; flex-direction: column; align-items: center;
        }

        .background-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('assets/bg.jpg') center/cover no-repeat;
            z-index: 0; pointer-events: none;
        }

        .draggable-box {
            position: fixed; 
            width: 180px; height: 180px;
            top: 150px; left: calc(50% - 90px);
            border-radius: 40px; 
            z-index: 1000; 
            cursor: grab;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem; font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.15);
            --liquid-backdrop: blur(5px) liquid-glass(4, 8, 2);
            user-select: none; touch-action: none;
            transition: transform 0.1s;
        }
        .draggable-box:active { cursor: grabbing; transform: scale(0.98); }

        .controls {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 25px; border-radius: 30px;
            box-sizing: border-box;
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 2000;
        }
        
        h1 { margin: 0 0 20px 0; font-size: 1.1rem; text-align: center; opacity: 0.8; }
        
        .row { margin-bottom: 15px; display: flex; gap: 15px; align-items: center; }
        .row label { width: 80px; opacity: 0.8; font-size: 0.9rem; }
        .row input { flex: 1; accent-color: #fff; cursor: pointer; }
        .row span { width: 30px; text-align: right; font-family: monospace; font-size: 0.8rem; opacity: 0.6; }
    </style>
</head>
<body>
    <div class="background-layer"></div>
    <div class="draggable-box" id="target">
        Drag Me
    </div>
    <div class="controls">
        <h1>LiquidBackdrop Playground</h1>
        <div class="row">
            <label>Blur</label>
            <input type="range" id="blur" min="0" max="30" value="5">
            <span id="val-blur">5</span>
        </div>
        <div class="row">
            <label>Refraction</label>
            <input type="range" id="ref" min="0" max="50" value="4">
            <span id="val-ref">4</span>
        </div>
        <div class="row">
            <label>Bevel</label>
            <input type="range" id="bev" min="0" max="50" value="8">
            <span id="val-bev">8</span>
        </div>
        <div class="row">
            <label>Chroma</label>
            <input type="range" id="chr" min="0" max="10" step="0.5" value="2">
            <span id="val-chr">2</span>
        </div>
    </div>

    <script type="module">
        import LiquidBackdrop from './src/liquidbackdrop.js';
        
        LiquidBackdrop.start();

        const box = document.getElementById('target');
        const inputs = {
            blur: document.getElementById('blur'),
            ref: document.getElementById('ref'),
            bev: document.getElementById('bev'),
            chr: document.getElementById('chr')
        };
        const values = {
            blur: document.getElementById('val-blur'),
            ref: document.getElementById('val-ref'),
            bev: document.getElementById('val-bev'),
            chr: document.getElementById('val-chr')
        };

        function update() {
            Object.keys(inputs).forEach(k => values[k].textContent = inputs[k].value);
            const val = `blur(${inputs.blur.value}px) liquid-glass(${inputs.ref.value}, ${inputs.bev.value}, ${inputs.chr.value}) saturate(1.2)`;
            box.style.setProperty('--liquid-backdrop', val);
        }
        Object.values(inputs).forEach(el => el.addEventListener('input', update));

        let isDragging = false;
        let startPos = { x: 0, y: 0 };
        let boxPos = { x: 0, y: 0 };

        function onDown(e) {
            isDragging = true;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const style = window.getComputedStyle(box);
            const matrix = new WebKitCSSMatrix(style.transform);
            
            startPos.x = clientX - box.offsetLeft;
            startPos.y = clientY - box.offsetTop;
            
            box.style.cursor = 'grabbing';
        }

        function onMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            const newX = clientX - startPos.x;
            const newY = clientY - startPos.y;

            box.style.left = `${newX}px`;
            box.style.top = `${newY}px`;
        }

        function onUp() {
            isDragging = false;
            box.style.cursor = 'grab';
        }

        box.addEventListener('mousedown', onDown);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onUp);

        box.addEventListener('touchstart', onDown, {passive: false});
        window.addEventListener('touchmove', onMove, {passive: false});
        window.addEventListener('touchend', onUp);
    </script>
</body>
</html>